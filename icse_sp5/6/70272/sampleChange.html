<link rel="stylesheet" href="../../../../default.css">
<script src="../../../../highlight.pack.js"></script> 
<script>hljs.initHighlightingOnLoad();</script>
<html><h3></h3><h3>Before Change</h3><pre><code class='java'>
                    QA_fetch_get_stock_min(str(code), &quot2015-01-01&quot, str(now_time())[0:19], &quot15min&quot)))
        except:
            __err.append(code)
    <a id="change">for i_ in range(len(__stock_list)):
        &#47&#47__saving_work(&quot000001&quot)
        QA_util_log_info(&quotThe %s of Total %s&quot % (i_, len(__stock_list)))
        QA_util_log_info(&quotDOWNLOAD PROGRESS %s &quot % str(
            float(i_ / len(__stock_list) * 100))[0:4] + &quot%&quot)
        __saving_work(__stock_list.index[i_])


</a>def QA_SU_save_index_day(client=QA_Setting.client):
    __index_list = QA_fetch_get_stock_list(&quotindex&quot)
    __coll = client.quantaxis.index_day
    __coll.ensure_index(&quotcode&quot)</code></pre><h3>After Change</h3><pre><code class='java'>
        except:
            __err.append(code)

    executor = <a id="change">ThreadPoolExecutor(max_workers=2)</a>

    res = {executor.submit(__saving_work,__stock_list.index[i_]) for i_ in range(len(__stock_list))}
    <a id="change">count = 0</a>
    for i_ in concurrent.futures.as_completed(res):
        QA_util_log_info(&quotThe %s of Total %s&quot % (count, len(__stock_list)))
        QA_util_log_info(&quotDOWNLOAD PROGRESS %s &quot % str(
            float(count / len(__stock_list) * 100))[0:4] + &quot%&quot)
        <a id="change">count = count + 1</a>


def QA_SU_save_index_day(client=QA_Setting.client):
    __index_list = QA_fetch_get_stock_list(&quotindex&quot)</code></pre>