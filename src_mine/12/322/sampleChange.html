<link rel="stylesheet" href="../../../../default.css">
<script src="../../../../highlight.pack.js"></script> 
<script>hljs.initHighlightingOnLoad();</script>
<html><h3></h3><h3>Before Change</h3><pre><code class='java'>
    self.tgt_seq2idx[start_id] = SpecialTextTokens.S_ID.value

    &#47&#47 sentence end
    <a id="change">end_id</a> = <a id="change">SpecialTextTokens.to_string(SpecialTextTokens.EOS_ID.value)</a>
    <a id="change">self.src_seq2idx[end_id]</a> = SpecialTextTokens.EOS_ID.value
    self.tgt_seq2idx[end_id] = SpecialTextTokens.EOS_ID.value

    &#47&#47 padding</code></pre><h3>After Change</h3><pre><code class='java'>
    self._shuffle_buffer_size = self.params.get(&quotshuffle_buffer_size&quot, -1)
    self._num_workers = num_workers
    self._worker_id = worker_id
    if self._pad_lengths_to_eight and <a id="change">not</a> (self.params[&quotmax_length&quot] % 8 == 0):
      raise ValueError("If padding to 8 in data layer, then "
                       "max_length should be multiple of 8")

    def file_len(fname):
      with open(fname) as f:
        for i, l in enumerate(f):
          pass
      return i + 1

    self.dataset_size = file_len(self.source_file)

    &#47&#47 load source and target vocabularies to RAM
    self.src_seq2idx = load_pre_existing_vocabulary(
      self.src_vocab_file,
      min_idx=SpecialTextTokens.UNK_ID.value + 1)
    self.tgt_seq2idx = load_pre_existing_vocabulary(
      self.tgt_vocab_file,
      min_idx=SpecialTextTokens.UNK_ID.value + 1)

    &#47&#47 unknown symbol
    self.src_seq2idx[
      SpecialTextTokens.to_string(SpecialTextTokens.UNK_ID.value)] = \
      SpecialTextTokens.UNK_ID.value
    self.tgt_seq2idx[
      SpecialTextTokens.to_string(SpecialTextTokens.UNK_ID.value)] = \
      SpecialTextTokens.UNK_ID.value

    &#47&#47 sentence start
    self.src_seq2idx[
      SpecialTextTokens.to_string(SpecialTextTokens.S_ID.value)] = \
      SpecialTextTokens.S_ID.value
    self.tgt_seq2idx[
      <a id="change">SpecialTextTokens.to_string(SpecialTextTokens.S_ID.value)</a>] = \
      SpecialTextTokens.S_ID.value
    &#47&#47 sentence end
    <a id="change">self.src_seq2idx[
      SpecialTextTokens.to_string(SpecialTextTokens.EOS_ID.value)]</a> = \
      SpecialTextTokens.EOS_ID.value
    self.tgt_seq2idx[
      SpecialTextTokens.to_string(SpecialTextTokens.EOS_ID.value)] = \</code></pre>