<html><h3>f3d79e3fe7f6450f804e8f41935b3e491a99f7e3,models/official/mnasnet/mnasnet_main.py,,,#,37
</h3><link rel="stylesheet" href="../../../../default.css">
<script src="../../../../highlight.pack.js"></script> 
<script>hljs.initHighlightingOnLoad();</script>
<html><h3></h3><h3>Before Change</h3><pre><code class='java'>
          &quot TensorFlow by default (e.g. CPU and GPU)&quot))

&#47&#47 Cloud TPU Cluster Resolvers
<a id="change">flags.DEFINE_string(
    &quottpu&quot,
    default=None,
    help=&quotThe Cloud TPU to use for training. This should be either the name &quot
    &quotused when creating the Cloud TPU, or a grpc://ip.address.of.tpu:8470 url.&quot)</a>

flags.DEFINE_string(
    &quotgcp_project&quot,
    default=None,
    help=&quotProject name for the Cloud TPU-enabled project. If not specified, we &quot
    &quotwill attempt to automatically detect the GCE project from metadata.&quot)

flags.DEFINE_string(
    &quottpu_zone&quot,
    default=None,
    help=&quotGCE zone where the Cloud TPU is located in. If not specified, we &quot
    &quotwill attempt to automatically detect the GCE project from metadata.&quot)

&#47&#47 Model specific flags
<a id="change">flags.DEFINE_string(
    &quotdata_dir&quot,
    default=FAKE_DATA_DIR,
    help=(&quotThe directory where the ImageNet input data is stored. Please see&quot
          &quot the README.md for the expected data format.&quot))</a>

<a id="change">flags.DEFINE_string(
    &quotmodel_dir&quot,
    default=None,
    help=(&quotThe directory where the model and training/evaluation summaries are&quot
          &quot stored.&quot))</a>

flags.DEFINE_string(
    &quotmodel_name&quot,
    default=&quotmnasnet-a1&quot,
    help=(
        &quotThe model name to select models among existing MnasNet configurations.&quot
    ))

flags.DEFINE_enum(&quotmode&quot, &quottrain_and_eval&quot,
                  [&quottrain_and_eval&quot, &quottrain&quot, &quoteval&quot, &quotexport_only&quot],
                  &quotOne of {"train_and_eval", "train", "eval", "export_only"}.&quot)

<a id="change">flags.DEFINE_integer(
    &quottrain_steps&quot,
    default=437898,
    help=(&quotThe number of steps to use for training. Default is 437898 steps&quot
          &quot which is approximately 350 epochs at batch size 1024. This flag&quot
          &quot should be adjusted according to the --train_batch_size flag.&quot))</a>

flags.DEFINE_integer(&quotinput_image_size&quot, default=224, help=&quotInput image size.&quot)

flags.DEFINE_integer(
    &quottrain_batch_size&quot, default=1024, help=&quotBatch size for training.&quot)

flags.DEFINE_integer(
    &quoteval_batch_size&quot, default=1024, help=&quotBatch size for evaluation.&quot)

flags.DEFINE_integer(
    &quotnum_train_images&quot, default=1281167, help=&quotSize of training data set.&quot)

flags.DEFINE_integer(
    &quotnum_eval_images&quot, default=50000, help=&quotSize of evaluation data set.&quot)

flags.DEFINE_integer(
    &quotsteps_per_eval&quot,
    default=6255,
    help=(&quotControls how often evaluation is performed. Since evaluation is&quot
          &quot fairly expensive, it is advised to evaluate as infrequently as&quot
          &quot possible (i.e. up to --train_steps, which evaluates the model only&quot
          &quot after finishing the entire training regime).&quot))

flags.DEFINE_integer(
    &quoteval_timeout&quot,
    default=None,
    help=&quotMaximum seconds between checkpoints before evaluation terminates.&quot)

flags.DEFINE_bool(
    &quotskip_host_call&quot,
    default=False,
    help=(&quotSkip the host_call which is executed every training step. This is&quot
          &quot generally used for generating training summaries (train loss,&quot
          &quot learning rate, etc...). When --skip_host_call=false, there could&quot
          &quot be a performance drop if host_call function is slow and cannot&quot
          &quot keep up with the TPU-side computation.&quot))

<a id="change">flags.DEFINE_integer(
    &quotiterations_per_loop&quot,
    default=1251,
    help=(&quotNumber of steps to run on TPU before outfeeding metrics to the CPU.&quot
          &quot If the number of iterations in the loop would exceed the number of&quot
          &quot train steps, the loop will exit before reaching&quot
          &quot --iterations_per_loop. The larger this value is, the higher the&quot
          &quot utilization on the TPU.&quot))</a>

flags.DEFINE_integer(
    &quotnum_parallel_calls&quot,
    default=64,</code></pre><h3>After Change</h3><pre><code class='java'>
from tensorflow.python.keras import backend as K

common_tpu_flags.define_common_tpu_flags()
<a id="change">common_hparams_flags.define_common_hparams_flags()</a>

FLAGS = flags.FLAGS

FAKE_DATA_DIR = &quotgs://cloud-tpu-test-datasets/fake_imagenet&quot</code></pre><img src="178924267.png" alt="Italian Trulli"   style="width:500px;height:500px;"><div id='inPattern'>In pattern: SUPERPATTERN</div><BR><div id='frequency'>Frequency: 3</div><BR><div id='size'>Non-data size: 7</div><BR><h3>Instances</h3><BR><div id='link'><a href='https://github.com/tensorflow/tpu/commit/f3d79e3fe7f6450f804e8f41935b3e491a99f7e3#diff-1b2556446c21831afa3b5930d46633ee5f20b58b95a971cb3ac402d6705a3b00L39' target='_blank'>Link</a></div><div id='project'> Project Name: tensorflow/tpu</div><div id='commit'> Commit Name: f3d79e3fe7f6450f804e8f41935b3e491a99f7e3</div><div id='time'> Time: 2019-07-02</div><div id='author'> Author: gardener@tensorflow.org</div><div id='file'> File Name: models/official/mnasnet/mnasnet_main.py</div><div id='class'> Class Name: </div><div id='method'> Method Name: </div><BR><BR><div id='link'><a href='https://github.com/tensorflow/tpu/commit/f3d79e3fe7f6450f804e8f41935b3e491a99f7e3#diff-1b2556446c21831afa3b5930d46633ee5f20b58b95a971cb3ac402d6705a3b00L39' target='_blank'>Link</a></div><div id='project'> Project Name: tensorflow/tpu</div><div id='commit'> Commit Name: f3d79e3fe7f6450f804e8f41935b3e491a99f7e3</div><div id='time'> Time: 2019-07-02</div><div id='author'> Author: gardener@tensorflow.org</div><div id='file'> File Name: models/official/mnasnet/mnasnet_main.py</div><div id='class'> Class Name: </div><div id='method'> Method Name: </div><BR><BR><div id='link'><a href='https://github.com/tensorflow/tpu/commit/377dbd0c1dc2ac1cf90556e9a4a5ecccbfa65a93#diff-18c556574b2174e67924a1d0bc66418339a96f82fddbb595bb07dc13f3ccb6caL39' target='_blank'>Link</a></div><div id='project'> Project Name: tensorflow/tpu</div><div id='commit'> Commit Name: 377dbd0c1dc2ac1cf90556e9a4a5ecccbfa65a93</div><div id='time'> Time: 2019-04-23</div><div id='author'> Author: allencwang@google.com</div><div id='file'> File Name: models/official/mobilenet/mobilenet.py</div><div id='class'> Class Name: </div><div id='method'> Method Name: </div><BR><BR><div id='link'><a href='https://github.com/tensorflow/tpu/commit/69d221deb018beed51b2f5216ca34c61cca92858#diff-17695b4a1fa19428a29de18949f15e98f523321456f61bfae840b0d97883394bL34' target='_blank'>Link</a></div><div id='project'> Project Name: tensorflow/tpu</div><div id='commit'> Commit Name: 69d221deb018beed51b2f5216ca34c61cca92858</div><div id='time'> Time: 2019-07-03</div><div id='author'> Author: gardener@tensorflow.org</div><div id='file'> File Name: models/official/squeezenet/squeezenet_main.py</div><div id='class'> Class Name: </div><div id='method'> Method Name: </div><BR>