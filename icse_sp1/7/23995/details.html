<html><h3>4061b72f2e0bdd6a739acbd727f54f37e5cc92ff,python/ray/serve/tests/test_backend_state.py,,test_new_version_and_scale_down,#Any#,1002
</h3><link rel="stylesheet" href="../../../../default.css">
<script src="../../../../highlight.pack.js"></script> 
<script>hljs.initHighlightingOnLoad();</script>
<html><h3></h3><h3>Before Change</h3><pre><code class='java'>

    assert len(backend_state._replicas) == 0

    <a id="change">b_config_1, r_config_1 = generate_configs(10)</a>
    goal_1 = backend_state.deploy_backend(
        TEST_TAG, b_config_1, r_config_1, version="1")

    backend_state.update()</code></pre><h3>After Change</h3><pre><code class='java'>

    &#47&#47 Now deploy a new version and scale down the number of replicas to 2.
    &#47&#47 First, 8 old replicas should be stopped to bring it down to the target.
    <a id="change">b_info_2 = backend_info(num_replicas=2, version="2")</a>
    goal_2 = backend_state.deploy_backend(TEST_TAG, b_info_2)
    backend_state.update()
    check_counts(
        backend_state,</code></pre><img src="126325392.png" alt="Italian Trulli"   style="width:500px;height:500px;"><div id='inPattern'>In pattern: SUPERPATTERN</div><BR><div id='frequency'>Frequency: 4</div><BR><div id='size'>Non-data size: 4</div><BR><h3>Instances</h3><BR><div id='link'><a href='https://github.com/ray-project/ray/commit/4061b72f2e0bdd6a739acbd727f54f37e5cc92ff#diff-80b863a5cc4343103863ea5233608fba6522ca3c1ab57bab89cb92ebf75be6f1L1010' target='_blank'>Link</a></div><div id='project'> Project Name: ray-project/ray</div><div id='commit'> Commit Name: 4061b72f2e0bdd6a739acbd727f54f37e5cc92ff</div><div id='time'> Time: 2021-03-31</div><div id='author'> Author: ed.nmi.oakes@gmail.com</div><div id='file'> File Name: python/ray/serve/tests/test_backend_state.py</div><div id='class'> Class Name: </div><div id='method'> Method Name: test_new_version_and_scale_down</div><BR><BR><div id='link'><a href='https://github.com/ray-project/ray/commit/4061b72f2e0bdd6a739acbd727f54f37e5cc92ff#diff-80b863a5cc4343103863ea5233608fba6522ca3c1ab57bab89cb92ebf75be6f1L745' target='_blank'>Link</a></div><div id='project'> Project Name: ray-project/ray</div><div id='commit'> Commit Name: 4061b72f2e0bdd6a739acbd727f54f37e5cc92ff</div><div id='time'> Time: 2021-03-31</div><div id='author'> Author: ed.nmi.oakes@gmail.com</div><div id='file'> File Name: python/ray/serve/tests/test_backend_state.py</div><div id='class'> Class Name: </div><div id='method'> Method Name: test_new_version_deploy_throttling</div><BR><BR><div id='link'><a href='https://github.com/ray-project/ray/commit/4061b72f2e0bdd6a739acbd727f54f37e5cc92ff#diff-80b863a5cc4343103863ea5233608fba6522ca3c1ab57bab89cb92ebf75be6f1L1174' target='_blank'>Link</a></div><div id='project'> Project Name: ray-project/ray</div><div id='commit'> Commit Name: 4061b72f2e0bdd6a739acbd727f54f37e5cc92ff</div><div id='time'> Time: 2021-03-31</div><div id='author'> Author: ed.nmi.oakes@gmail.com</div><div id='file'> File Name: python/ray/serve/tests/test_backend_state.py</div><div id='class'> Class Name: </div><div id='method'> Method Name: test_new_version_and_scale_up</div><BR><BR><div id='link'><a href='https://github.com/ray-project/ray/commit/4061b72f2e0bdd6a739acbd727f54f37e5cc92ff#diff-80b863a5cc4343103863ea5233608fba6522ca3c1ab57bab89cb92ebf75be6f1L717' target='_blank'>Link</a></div><div id='project'> Project Name: ray-project/ray</div><div id='commit'> Commit Name: 4061b72f2e0bdd6a739acbd727f54f37e5cc92ff</div><div id='time'> Time: 2021-03-31</div><div id='author'> Author: ed.nmi.oakes@gmail.com</div><div id='file'> File Name: python/ray/serve/tests/test_backend_state.py</div><div id='class'> Class Name: </div><div id='method'> Method Name: test_initial_deploy_no_throttling</div><BR>