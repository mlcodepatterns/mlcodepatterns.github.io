<link rel="stylesheet" href="../../../../default.css">
<script src="../../../../highlight.pack.js"></script> 
<script>hljs.initHighlightingOnLoad();</script>
<html><h3></h3><h3>Before Change</h3><pre><code class='java'>
        bdb.execute(&quotBEGIN&quot)
        try:
            with open(fname, &quotrU&quot) as f:
                <a id="change">read_csv.bayesdb_read_csv(bdb, &quott&quot, f, header=True,
                    create=True)</a>
            bdb.execute(&quotSELECT * FROM t&quot)
            guess.bayesdb_guess_generator(bdb, &quott_cc&quot, &quott&quot, &quotcrosscat&quot)
            bdb.execute(&quotESTIMATE * FROM t_cc&quot)
        finally:
            bdb.execute(&quotROLLBACK&quot)
        with pytest.raises(sqlite3.OperationalError):
            bdb.execute(&quotSELECT * FROM t&quot)
        with pytest.raises(ValueError):
            bdb.execute(&quotESTIMATE * FROM t_cc&quot)

        &#47&#47 Make sure CREATE and DROP both work in the transaction.
        bdb.execute(&quotBEGIN&quot)
        try:
            with open(fname, &quotrU&quot) as f:
                read_csv.bayesdb_read_csv(bdb, &quott&quot, f, header=True,
                    create=True)
            bdb.execute(&quotSELECT * FROM t&quot)
            guess.bayesdb_guess_generator(bdb, &quott_cc&quot, &quott&quot, &quotcrosscat&quot)
            bdb.execute(&quotESTIMATE * FROM t_cc&quot)
            with pytest.raises(ValueError):
                bdb.execute(&quotDROP TABLE t&quot)
            bdb.execute(&quotDROP GENERATOR t_cc&quot)
            with pytest.raises(ValueError):
                bdb.execute(&quotESTIMATE * FROM t_cc&quot)
            bdb.execute(&quotDROP TABLE t&quot)
            with pytest.raises(sqlite3.OperationalError):
                bdb.execute(&quotSELECT * FROM t&quot)
        finally:
            bdb.execute(&quotROLLBACK&quot)
        with pytest.raises(ValueError):
            bdb.execute(&quotESTIMATE * FROM t_cc&quot)
        with pytest.raises(sqlite3.OperationalError):
            bdb.execute(&quotSELECT * FROM t&quot)

        &#47&#47 Make sure CREATE and DROP work even if we commit.
        bdb.execute(&quotBEGIN&quot)
        try:
            with open(fname, &quotrU&quot) as f:
                <a id="change">read_csv.bayesdb_read_csv(bdb, &quott&quot, f, header=True,
                    create=True)</a>
            bdb.execute(&quotSELECT * FROM t&quot)
            guess.bayesdb_guess_generator(bdb, &quott_cc&quot, &quott&quot, &quotcrosscat&quot)
            bdb.execute(&quotESTIMATE * FROM t_cc&quot)
            with pytest.raises(ValueError):
                bdb.execute(&quotDROP TABLE t&quot)
            bdb.execute(&quotDROP GENERATOR t_cc&quot)
            with pytest.raises(ValueError):
                bdb.execute(&quotESTIMATE * FROM t_cc&quot)
            bdb.execute(&quotDROP TABLE t&quot)
            with pytest.raises(sqlite3.OperationalError):
                bdb.execute(&quotSELECT * FROM t&quot)
        finally:
            bdb.execute(&quotCOMMIT&quot)
        with pytest.raises(ValueError):
            bdb.execute(&quotESTIMATE * FROM t_cc&quot)
        with pytest.raises(sqlite3.OperationalError):
            bdb.execute(&quotSELECT * FROM t&quot)

        &#47&#47 Make sure CREATE persists if we commit.
        bdb.execute(&quotBEGIN&quot)
        try:
            with open(fname, &quotrU&quot) as f:
                <a id="change">read_csv.bayesdb_r</a>ead_csv(bdb, &quott&quot, f, header=True,
                    create=True)
            bdb.execute(&quotSELECT * FROM t&quot)
            guess.bayesdb_guess_generator(bdb, &quott_cc&quot, &quott&quot, &quotcrosscat&quot)</code></pre><h3>After Change</h3><pre><code class='java'>
        bdb.execute(&quotBEGIN&quot)
        try:
            with open(fname, &quotrU&quot) as f:
                <a id="change">bayeslite.bayesdb_read_csv(bdb, &quott&quot, f, header=True,
                    create=True)</a>
            bdb.execute(&quotSELECT * FROM t&quot)
            guess.bayesdb_guess_generator(bdb, &quott_cc&quot, &quott&quot, &quotcrosscat&quot)
            bdb.execute(&quotESTIMATE * FROM t_cc&quot)
            with pytest.raises(ValueError):
                bdb.execute(&quotDROP TABLE t&quot)
            bdb.execute(&quotDROP GENERATOR t_cc&quot)
            with pytest.raises(ValueError):
                bdb.execute(&quotESTIMATE * FROM t_cc&quot)
            bdb.execute(&quotDROP TABLE t&quot)
            with pytest.raises(sqlite3.OperationalError):
                bdb.execute(&quotSELECT * FROM t&quot)
        finally:
            bdb.execute(&quotROLLBACK&quot)
        with pytest.raises(ValueError):
            bdb.execute(&quotESTIMATE * FROM t_cc&quot)
        with pytest.raises(sqlite3.OperationalError):
            bdb.execute(&quotSELECT * FROM t&quot)

        &#47&#47 Make sure CREATE and DROP work even if we commit.
        bdb.execute(&quotBEGIN&quot)
        try:
            with open(fname, &quotrU&quot) as f:
                <a id="change">bayeslite.bayesdb_read_csv(bdb, &quott&quot, f, header=True,
                    create=True)</a>
            bdb.execute(&quotSELECT * FROM t&quot)
            guess.bayesdb_guess_generator(bdb, &quott_cc&quot, &quott&quot, &quotcrosscat&quot)
            bdb.execute(&quotESTIMATE * FROM t_cc&quot)
            with pytest.raises(ValueError):</code></pre>