<html><h3>197a7f917dfc540b59f6f1b5c397c89c05436eb9,tests/test_backtest.py,,test_Results_helper_functions_fi,#,164
</h3><link rel="stylesheet" href="../../../../default.css">
<script src="../../../../highlight.pack.js"></script> 
<script>hljs.initHighlightingOnLoad();</script>
<html><h3></h3><h3>Before Change</h3><pre><code class='java'>
    &#47&#47 algo to set the weights
    &#47&#47  it will only run when runMonthlyAlgo returns true
    &#47&#47  which only happens on the first of every month
    <a id="change">weights = pd.Series([0.6, 0.4], index=rdf.columns)</a>
    weighSpecifiedAlgo = bt.algos.WeighSpecified(**weights)

    &#47&#47 algo to rebalance the current weights to weights set by weighSpecified
    &#47&#47  will only run when weighSpecifiedAlgo returns true</code></pre><h3>After Change</h3><pre><code class='java'>
        progress_bar=False,
        additional_data = {&quotmydata&quot:pdf}
    )
    <a id="change">bidoffer = 1.</a>
    backtest2 = bt.Backtest(
        strat,
        pdf,
        initial_capital = 0,
        integer_positions=False,
        progress_bar=False,
        additional_data = <a id="change">{&quotmydata&quot:pdf, 
                           &quotbidoffer&quot: pd.DataFrame( bidoffer, pdf.index, pdf.columns )}</a>
    )
    random.seed(1234)
    res = bt.run(backtest)
    random.seed(1234)
    <a id="change">res2 = bt.run(backtest2)</a>

    assert(type(res.get_security_weights()) is pd.DataFrame)

    assert (type(res.get_transactions()) is pd.DataFrame)
    assert len(res.get_transactions()) &gt; 0

    assert (type(res.get_weights()) is pd.DataFrame)

    &#47&#47 Make sure the insertion of the first row applies to additional data as well
    assert backtest.data.index.equals( backtest.additional_data[&quotmydata&quot].index )

    &#47&#47 Check that bid/offer is accounted for
    <a id="change">transactions = res.get_transactions()</a>        
    <a id="change">transactions[&quotprice&quot] = transactions[&quotprice&quot] + 0.5 * bidoffer</a>
    assert (res2.get_transactions().price - res2.get_transactions().price).abs().sum() == 0
        
        
def test_30_min_data():</code></pre><img src="11899713.png" alt="Italian Trulli"   style="width:500px;height:500px;"><div id='inPattern'>In pattern: SUPERPATTERN</div><BR><div id='frequency'>Frequency: 3</div><BR><div id='size'>Non-data size: 8</div><BR><h3>Instances</h3><BR><div id='link'><a href='https://github.com/pmorissette/bt/commit/197a7f917dfc540b59f6f1b5c397c89c05436eb9#diff-2cada72487d55ccb31eb8f6ac8026b95f8eb9dda58c7af407564b0499a8f868fL169' target='_blank'>Link</a></div><div id='project'> Project Name: pmorissette/bt</div><div id='commit'> Commit Name: 197a7f917dfc540b59f6f1b5c397c89c05436eb9</div><div id='time'> Time: 2020-11-05</div><div id='author'> Author: pascal.i.tomecek@jpmorgan.com</div><div id='file'> File Name: tests/test_backtest.py</div><div id='class'> Class Name: </div><div id='method'> Method Name: test_Results_helper_functions_fi</div><BR><BR><div id='link'><a href='https://github.com/galeone/dynamic-training-bench/commit/50914556832ada0004e55f004eed2b44f448cac6#diff-276aed18096c696147f9ec58dffac0a5f36eba372de28b882b49b161ced3a22fL108' target='_blank'>Link</a></div><div id='project'> Project Name: galeone/dynamic-training-bench</div><div id='commit'> Commit Name: 50914556832ada0004e55f004eed2b44f448cac6</div><div id='time'> Time: 2016-10-25</div><div id='author'> Author: nessuno@nerdz.eu</div><div id='file'> File Name: train_fixed_dropout.py</div><div id='class'> Class Name: </div><div id='method'> Method Name: train</div><BR><BR><div id='link'><a href='https://github.com/tensorflow/tensorboard/commit/17ba11f67dae7b1fba8d7fb6de65472d328847ff#diff-101b37c28db86ca39eb302fbc2147e63131cb4847b52a1162bd31eeee8b576eeL111' target='_blank'>Link</a></div><div id='project'> Project Name: tensorflow/tensorboard</div><div id='commit'> Commit Name: 17ba11f67dae7b1fba8d7fb6de65472d328847ff</div><div id='time'> Time: 2016-04-01</div><div id='author'> Author: danmane@gmail.com</div><div id='file'> File Name: scripts/generate_testdata.py</div><div id='class'> Class Name: </div><div id='method'> Method Name: WriteImageSeries</div><BR>